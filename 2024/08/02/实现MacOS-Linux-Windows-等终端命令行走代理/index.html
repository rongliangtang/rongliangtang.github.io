<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="这是RongLiang的博客,用来分享技术知识和一些感悟。"><title>实现 MacOS, Linux, Windows 等终端命令行走代理 | Tom's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">实现 MacOS, Linux, Windows 等终端命令行走代理</h1><a id="logo" href="/.">Tom's Blog</a><p class="description">野蛮生长</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 文章</i></a><a href="/archives/"><i class="fa undefined"> 总览</i></a><a href="/about/"><i class="fa undefined"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">实现 MacOS, Linux, Windows 等终端命令行走代理</h1><div class="post-meta">2024-08-02</div><div class="post-content"><p>在之前的一篇文章中，介绍了如何在无用户界面 GUI 的 Ubuntu 服务器上实现走代理。然而本文解决的是这样一个问题：当我们在本地开启了代理（例如 xclash、Shadowsocket 等），在浏览器上可以走代理，但是命令行无法访问，特别是当我们使用 git 等操作时。</p>
<span id="more"></span>

<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>代理软件设置的是系统代理，<strong>MacOS, Linux, Windows 等操作系统的终端不走系统设置的代理</strong>，终端代理和系统代理不是一回事。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>下面介绍 MacOS, Linux 这类 Unix 系列操作系统的解决办法，也是我日常使用的方法。Windows 用户可以自行上网找，道理是一样的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> https_proxy=http://127.0.0.1:7890</span><br><span class="line"><span class="built_in">export</span> http_proxy=http://127.0.0.1:7890</span><br><span class="line"><span class="built_in">export</span> all_proxy=socks5://127.0.0.1:7890</span><br></pre></td></tr></table></figure>

<p>在已经开启代理软件，并且浏览器可以正常走代理的情况下。我们可以在命令行输入上面的命令，临时设置终端的代理，注意打开新的终端需要再次输入。因为我使用的是 xclash，所以端口是7890，其他的代理软件端口可能不一样。</p>
<p>上面命令的作用是分别设置了终端中 HTTP、HTTPS 和其他协议（如 SOCKS5）的网络代理：<code>export https_proxy=http://127.0.0.1:7890</code> 指定 HTTPS 请求通过本地代理服务器 <code>127.0.0.1:7890</code>，<code>export http_proxy=http://127.0.0.1:7890</code> 指定 HTTP 请求通过同一个代理服务器，<code>export all_proxy=socks5://127.0.0.1:7890</code> 则为其他类型的网络请求（如 SOCKS5 协议）指定了相同的代理服务器。这些设置确保终端中的所有网络流量都通过指定的代理进行。</p>
<p>如果觉得每次输入一大串麻烦，可以在 shell 的配置文件中，设置相关的函数，以 MacOS 为例。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 shell 配置文件</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">touch</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>然后输入以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 开启代理</span><br><span class="line">proxy_on() &#123;</span><br><span class="line">    export https_proxy=http://127.0.0.1:7890</span><br><span class="line">    export http_proxy=http://127.0.0.1:7890</span><br><span class="line">    export all_proxy=socks5://127.0.0.1:7890</span><br><span class="line">    echo &quot;HTTP/HTTPS Proxy on&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 关闭代理</span><br><span class="line">proxy_off() &#123;</span><br><span class="line">    unset http_proxy</span><br><span class="line">    unset https_proxy</span><br><span class="line">    unset all_proxy</span><br><span class="line">    echo &quot;HTTP/HTTPS Proxy off&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 刷新配置文件，使其生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>这样每次我们在终端可以通过 <code>proxy_on</code> 和 <code>proxy_of</code> 命令，方便的关闭、开启代理了。注意开启代理要保证打开了代理软件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试能否成功访问代理</span></span><br><span class="line">curl www.google.com</span><br></pre></td></tr></table></figure>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li></ul></div><div class="post-nav"><a class="pre" href="/2024/08/06/%E5%9B%A2%E9%98%9F%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84-Git-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/">团队开发中的 Git 工作流程</a><a class="next" href="/2024/08/01/Ubuntu%20%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%9E%E7%8E%B0%E8%B5%B0%E4%BB%A3%E7%90%86/">Ubuntu 通过命令行实现走代理</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Java-%E5%90%8E%E7%AB%AF/" style="font-size: 15px;">Java 后端</a> <a href="/tags/DevOps/" style="font-size: 15px;">DevOps</a> <a href="/tags/K8s/" style="font-size: 15px;">K8s</a> <a href="/tags/Jupyter-%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/" style="font-size: 15px;">Jupyter 二次开发</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 15px;">教程</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 15px;">工具</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 联系我</i></div><ul></ul><a href="mailto:trl2025@163.com" title="Mail" target="_blank">Mail</a><ul></ul><a href="https://github.com/rongliangtang" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://space.bilibili.com/28159312" title="Bilibili" target="_blank">Bilibili</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 Tom</div></div></div><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>